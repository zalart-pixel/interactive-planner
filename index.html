<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Dyninno Office Space Planner V2 - Advanced office space planning with dual currency and office-only costs">
    <title>Dyninno Office Space Planner V2 | Professional Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Modern color palette */
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #14b8a6;
            --accent: #f59e0b;
            --danger: #ef4444;
            --success: #22c55e;
            --dark: #0f172a;
            --light: #f8fafc;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --gray-dark: #334155;
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-accent: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --gradient-dark: linear-gradient(135deg, #1e3a8a 0%, #312e81 100%);
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            
            /* Glassmorphism */
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.18);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
            position: relative;
            overflow-x: hidden;
        }

        /* Animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23ffffff" fill-opacity="0.03"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
            z-index: -1;
        }

        /* Modern Navigation */
        .navbar {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
        }

        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 45px;
            height: 45px;
            background: var(--gradient-primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
            box-shadow: var(--shadow);
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .version-badge {
            background: var(--success);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .location-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: white;
            border-radius: 30px;
            box-shadow: var(--shadow);
            font-weight: 500;
        }

        .location-badge i {
            color: var(--primary);
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .kpi-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 1.5rem;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }

        .kpi-label {
            color: var(--gray);
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 0.25rem;
        }

        .kpi-change {
            font-size: 0.875rem;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .kpi-change.negative {
            color: var(--danger);
        }

        .kpi-subvalue {
            font-size: 0.875rem;
            color: var(--gray);
            margin-top: 0.25rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: white;
            border: 2px solid transparent;
            border-radius: 12px;
            font-weight: 500;
            color: var(--gray-dark);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tab-btn:hover {
            background: var(--primary-light);
            color: white;
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow);
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            margin-bottom: 2rem;
        }

        .card-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--gray-light);
        }

        .card-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-title i {
            color: var(--primary);
        }

        .card-subtitle {
            color: var(--gray);
            font-size: 0.95rem;
        }

        /* Form Groups */
        .form-section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 500;
            color: var(--gray-dark);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input,
        .form-select {
            padding: 0.75rem;
            border: 2px solid var(--gray-light);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .input-group input {
            flex: 1;
        }

        .input-suffix {
            color: var(--gray);
            font-weight: 500;
        }

        /* Department Cards */
        .department-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
        }

        .department-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .department-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .department-name {
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .department-badge {
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
        }

        .chart-container {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid var(--glass-border);
            height: 300px;
        }

        .chart-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 1rem;
        }

        /* Matrix Table */
        .matrix-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .matrix-table thead {
            background: var(--gradient-primary);
            color: white;
        }

        .matrix-table th,
        .matrix-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--gray-light);
        }

        .matrix-table tbody tr:hover {
            background: var(--light);
        }

        .matrix-table input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--gray-light);
            border-radius: 6px;
        }
        
        /* Space Matrix Grouped Styles */
        .space-matrix-grouped {
            padding: 1rem 0;
        }
        
        .space-group {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        
        .space-group:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }
        
        .group-header {
            padding: 1rem;
            background: linear-gradient(90deg, rgba(99, 102, 241, 0.05) 0%, transparent 100%);
        }
        
        .group-header input {
            font-weight: 600;
            font-size: 1.125rem;
            background: transparent;
            border: none;
            color: #1f2937;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .group-header input:hover {
            background: rgba(255,255,255,0.5);
        }
        
        .group-header input:focus {
            outline: none;
            background: white;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.3);
        }
        
        .space-summary {
            background: var(--gradient-primary);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 2rem;
            box-shadow: var(--shadow-lg);
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .btn-sm:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem;
            margin-top: 4rem;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--glass-border);
        }

        .footer-text {
            color: var(--gray-dark);
            font-size: 0.875rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar-content {
                padding: 1rem;
            }
            
            .kpi-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .kpi-value {
                font-size: 1.5rem;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark);
            color: white;
            text-align: center;
            border-radius: 8px;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            border-radius: 12px;
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-xl);
            display: none;
            align-items: center;
            gap: 1rem;
            animation: slideIn 0.3s ease;
            z-index: 2000;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
            }
            to {
                transform: translateX(0);
            }
        }

        .notification.success {
            border-left: 4px solid var(--success);
        }

        .notification.error {
            border-left: 4px solid var(--danger);
        }

        /* Currency Display */
        .currency-display {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .currency-primary {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
        }

        .currency-secondary {
            font-size: 0.875rem;
            color: var(--gray);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <div class="navbar">
        <div class="navbar-content">
            <div class="logo-section">
                <div class="logo-icon">D</div>
                <div class="logo-text">Dyninno Office Planner</div>
                <span class="version-badge">V2.0</span>
            </div>
            <div class="location-badge" id="locationBadge">
                <i class="fas fa-map-marker-alt"></i>
                <span id="locationText">Delhi/NCR, India (INR)</span>
            </div>
            <div style="display: flex; gap: 1rem;">
                <button class="btn btn-primary" onclick="generateReport()">
                    <i class="fas fa-file-pdf"></i> Export Report
                </button>
                <button class="btn btn-secondary" onclick="exportData()">
                    <i class="fas fa-download"></i> Save Data
                </button>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- KPI Dashboard -->
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-label">Total Office Area</div>
                <div class="kpi-value" id="kpiTotalArea">0</div>
                <div class="kpi-subvalue">sq meters</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Total Headcount</div>
                <div class="kpi-value" id="kpiHeadcount">0</div>
                <div class="kpi-subvalue">employees</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Monthly Office Cost</div>
                <div class="currency-display">
                    <div class="currency-primary" id="kpiMonthlyCost">$0</div>
                    <div class="currency-secondary" id="kpiMonthlyCostUSD">$0 USD</div>
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Cost per Employee</div>
                <div class="currency-display">
                    <div class="currency-primary" id="kpiCostPerPerson">$0</div>
                    <div class="currency-secondary" id="kpiCostPerPersonUSD">$0 USD</div>
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Space Efficiency</div>
                <div class="kpi-value" id="kpiEfficiency">0%</div>
                <div class="kpi-subvalue">workspace utilization</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Move-in Investment</div>
                <div class="currency-display">
                    <div class="currency-primary" id="kpiMoveInCost">$0</div>
                    <div class="currency-secondary" id="kpiMoveInCostUSD">$0 USD</div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('input')">
                <i class="fas fa-edit"></i> Input Data
            </button>
            <button class="tab-btn" onclick="showTab('costs')">
                <i class="fas fa-dollar-sign"></i> Costs
            </button>
            <button class="tab-btn" onclick="showTab('matrix')">
                <i class="fas fa-table"></i> Space Matrix
            </button>
            <button class="tab-btn" onclick="showTab('analytics')">
                <i class="fas fa-chart-bar"></i> Analytics
            </button>
            <button class="tab-btn" onclick="showTab('comparison')">
                <i class="fas fa-balance-scale"></i> Comparison
            </button>
        </div>

        <!-- Tab Content -->
        <div class="tab-container">
            <!-- Input Tab -->
            <div id="inputTab" class="tab-content">
                <!-- Location Section -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-globe"></i>
                            Location & Currency
                        </h2>
                        <p class="card-subtitle">Select office location and currency settings</p>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Country</label>
                            <select class="form-select" id="country" onchange="updateCities()">
                                <option value="">Select Country</option>
                                <option value="india" selected>India</option>
                                <option value="uae">United Arab Emirates</option>
                                <option value="azerbaijan">Azerbaijan</option>
                                <option value="latvia">Latvia</option>
                                <option value="uk">United Kingdom</option>
                                <option value="uzbekistan">Uzbekistan</option>
                                <option value="cyprus">Cyprus</option>
                                <option value="malta">Malta</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">City</label>
                            <select class="form-select" id="city" onchange="updateOfficeDefaults()">
                                <option value="">Select City</option>
                                <option value="delhi" selected>Delhi/NCR</option>
                                <option value="gurgaon">Gurgaon</option>
                                <option value="noida">Noida</option>
                                <option value="mumbai">Mumbai</option>
                                <option value="bangalore">Bangalore</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Currency</label>
                            <select class="form-select" id="currency" onchange="updateLocationBadge()">
                                <option value="USD">USD - US Dollar</option>
                                <option value="EUR">EUR - Euro</option>
                                <option value="GBP">GBP - British Pound</option>
                                <option value="AED">AED - UAE Dirham</option>
                                <option value="INR" selected>INR - Indian Rupee</option>
                                <option value="AZN">AZN - Azerbaijani Manat</option>
                                <option value="UZS">UZS - Uzbek Som</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Headcount Section -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-users"></i>
                            Department Headcount
                        </h2>
                        <p class="card-subtitle">Configure team sizes by department</p>
                    </div>

                    <div class="form-grid">
                        <div class="department-card" style="border-left: 4px solid #3b82f6;">
                            <div class="department-header">
                                <div class="department-name">
                                    <i class="fas fa-chart-line"></i> Sales
                                </div>
                                <div class="department-badge">Revenue</div>
                            </div>
                            <div class="input-group">
                                <input type="number" class="form-input" id="salesCount" value="250" onchange="calculate()">
                                <span class="input-suffix">people</span>
                            </div>
                        </div>

                        <div class="department-card" style="border-left: 4px solid #10b981;">
                            <div class="department-header">
                                <div class="department-name">
                                    <i class="fas fa-headset"></i> Customer Support
                                </div>
                                <div class="department-badge">Service</div>
                            </div>
                            <div class="input-group">
                                <input type="number" class="form-input" id="csCount" value="30" onchange="calculate()">
                                <span class="input-suffix">people</span>
                            </div>
                        </div>

                        <div class="department-card" style="border-left: 4px solid #8b5cf6;">
                            <div class="department-header">
                                <div class="department-name">
                                    <i class="fas fa-laptop-code"></i> IT
                                </div>
                                <div class="department-badge">Tech</div>
                            </div>
                            <div class="input-group">
                                <input type="number" class="form-input" id="itCount" value="70" onchange="calculate()">
                                <span class="input-suffix">people</span>
                            </div>
                        </div>

                        <div class="department-card" style="border-left: 4px solid #f59e0b;">
                            <div class="department-header">
                                <div class="department-name">
                                    <i class="fas fa-briefcase"></i> Support Functions
                                </div>
                                <div class="department-badge">Admin</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">HR</label>
                                <input type="number" class="form-input" id="hrCount" value="14" onchange="calculate()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Finance</label>
                                <input type="number" class="form-input" id="financeCount" value="8" onchange="calculate()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Admin</label>
                                <input type="number" class="form-input" id="adminCount" value="7" onchange="calculate()">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Space Requirements -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-ruler-combined"></i>
                            Space Requirements
                        </h2>
                        <p class="card-subtitle">Workspace allocation per department</p>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Sales (sq m/person) - High Density</label>
                            <input type="number" class="form-input" id="salesSpace" value="3" step="0.5" onchange="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Customer Support (sq m/person) - High Density</label>
                            <input type="number" class="form-input" id="csSpace" value="3.5" step="0.5" onchange="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">IT (sq m/person)</label>
                            <input type="number" class="form-input" id="itSpace" value="5" step="0.5" onchange="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Support Functions (sq m/person)</label>
                            <input type="number" class="form-input" id="supportSpace" value="6" step="0.5" onchange="calculate()">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Costs Tab -->
            <div id="costsTab" class="tab-content" style="display: none;">
                <!-- Operating Costs -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-coins"></i>
                            Office Operating Costs (OPEX)
                        </h2>
                        <p class="card-subtitle">Monthly recurring office expenses</p>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Rent per sq m (monthly)</label>
                            <input type="number" class="form-input" id="rentPerSqm" value="1200" onchange="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Utilities (monthly)</label>
                            <input type="number" class="form-input" id="utilities" value="150000" onchange="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Maintenance (monthly)</label>
                            <input type="number" class="form-input" id="maintenance" value="75000" onchange="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Cleaning Services (monthly)</label>
                            <input type="number" class="form-input" id="cleaning" value="60000" onchange="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Security Services (monthly)</label>
                            <input type="number" class="form-input" id="security" value="80000" onchange="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Insurance (monthly)</label>
                            <input type="number" class="form-input" id="insurance" value="40000" onchange="calculate()">
                        </div>
                    </div>
                </div>

                <!-- Move-in Costs -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-truck-moving"></i>
                            Office Setup Costs (CAPEX)
                        </h2>
                        <p class="card-subtitle">One-time capital expenditure for office setup</p>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Security Deposit (months)</label>
                            <input type="number" class="form-input" id="securityDeposit" value="6" onchange="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Fitout Cost per sq m</label>
                            <input type="number" class="form-input" id="fitoutCost" value="3500" onchange="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Furniture per workstation</label>
                            <input type="number" class="form-input" id="workstationCost" value="25000" onchange="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">IT Infrastructure per person</label>
                            <input type="number" class="form-input" id="itEquipmentCost" value="45000" onchange="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Legal & Broker Fees</label>
                            <input type="number" class="form-input" id="legalFees" value="1000000" onchange="calculate()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Contingency (%)</label>
                            <input type="number" class="form-input" id="contingency" value="15" onchange="calculate()">
                        </div>
                    </div>
                </div>

                <!-- Cost Summary -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-calculator"></i>
                            Cost Summary
                        </h2>
                        <p class="card-subtitle">Total office investment and operating costs</p>
                    </div>

                    <div class="form-grid">
                        <div class="kpi-card">
                            <div class="kpi-label">Total CAPEX Investment</div>
                            <div class="currency-display">
                                <div class="currency-primary" id="totalMoveInCost">$0</div>
                                <div class="currency-secondary" id="totalMoveInCostUSD">$0 USD</div>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">Monthly OPEX</div>
                            <div class="currency-display">
                                <div class="currency-primary" id="monthlyOperatingCost">$0</div>
                                <div class="currency-secondary" id="monthlyOperatingCostUSD">$0 USD</div>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">Annual Office TCO</div>
                            <div class="currency-display">
                                <div class="currency-primary" id="annualTCO">$0</div>
                                <div class="currency-secondary" id="annualTCOUSD">$0 USD</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Space Matrix Tab -->
            <div id="matrixTab" class="tab-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-th"></i>
                            Space Matrix
                        </h2>
                        <p class="card-subtitle">Detailed space allocation breakdown</p>
                    </div>

                    <div id="spaceMatrixContainer">
                        <!-- Will be populated by JavaScript -->
                    </div>

                    <div style="margin-top: 1rem; display: flex; gap: 1rem;">
                        <button class="btn btn-success" onclick="applyTemplate()">
                            <i class="fas fa-magic"></i> Apply Template
                        </button>
                        <button class="btn btn-secondary" onclick="resetSpaceGroups()">
                            <i class="fas fa-redo"></i> Reset to Default
                        </button>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analyticsTab" class="tab-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-chart-line"></i>
                            Analytics & Projections
                        </h2>
                        <p class="card-subtitle">Data-driven insights for office costs and space utilization</p>
                    </div>

                    <div class="charts-grid">
                        <div class="chart-container">
                            <h3 class="chart-title">Space Distribution</h3>
                            <canvas id="spaceChart"></canvas>
                        </div>

                        <div class="chart-container">
                            <h3 class="chart-title">Office OPEX Breakdown</h3>
                            <canvas id="costChart"></canvas>
                        </div>

                        <div class="chart-container">
                            <h3 class="chart-title">5-Year Office Cost Projection</h3>
                            <canvas id="projectionChart"></canvas>
                        </div>

                        <div class="chart-container">
                            <h3 class="chart-title">Department Headcount</h3>
                            <canvas id="headcountChart"></canvas>
                        </div>

                        <div class="chart-container">
                            <h3 class="chart-title">CAPEX Distribution</h3>
                            <canvas id="capexChart"></canvas>
                        </div>

                        <div class="chart-container">
                            <h3 class="chart-title">Cost per Sq M Analysis</h3>
                            <canvas id="efficiencyChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comparison Tab -->
            <div id="comparisonTab" class="tab-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-balance-scale"></i>
                            Location Comparison
                        </h2>
                        <p class="card-subtitle">Compare different locations and configurations</p>
                    </div>

                    <div id="comparisonResults">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p class="footer-text">
            Â© 2024 Dyninno Office Space Planner V2 | Professional Edition | Focus on Office OPEX & CAPEX
        </p>
    </div>

    <script>
        // Exchange rates for USD conversion (simplified - in production use real-time rates)
        const exchangeRates = {
            'USD': 1,
            'EUR': 0.92,
            'GBP': 0.79,
            'AED': 3.67,
            'INR': 83.50,
            'AZN': 1.70,
            'UZS': 12600
        };

        // Dyninno Office Locations Data
        const cityData = {
            india: {
                name: 'India',
                cities: [
                    { value: 'delhi', text: 'Delhi/NCR', currency: 'INR', rate: 1200, moveInMultiplier: 1.2 },
                    { value: 'gurgaon', text: 'Gurgaon', currency: 'INR', rate: 1400, moveInMultiplier: 1.3 },
                    { value: 'noida', text: 'Noida', currency: 'INR', rate: 1000, moveInMultiplier: 1.1 },
                    { value: 'mumbai', text: 'Mumbai', currency: 'INR', rate: 2500, moveInMultiplier: 1.5 },
                    { value: 'bangalore', text: 'Bangalore', currency: 'INR', rate: 1800, moveInMultiplier: 1.3 }
                ]
            },
            uae: {
                name: 'United Arab Emirates',
                cities: [
                    { value: 'dubai', text: 'Dubai', currency: 'AED', rate: 180, moveInMultiplier: 1.4 },
                    { value: 'abudhabi', text: 'Abu Dhabi', currency: 'AED', rate: 150, moveInMultiplier: 1.3 },
                    { value: 'sharjah', text: 'Sharjah', currency: 'AED', rate: 100, moveInMultiplier: 1.2 }
                ]
            },
            azerbaijan: {
                name: 'Azerbaijan',
                cities: [
                    { value: 'baku', text: 'Baku', currency: 'AZN', rate: 15, moveInMultiplier: 1.2 },
                    { value: 'sumgait', text: 'Sumgait', currency: 'AZN', rate: 10, moveInMultiplier: 1.1 },
                    { value: 'ganja', text: 'Ganja', currency: 'AZN', rate: 8, moveInMultiplier: 1.0 }
                ]
            },
            latvia: {
                name: 'Latvia',
                cities: [
                    { value: 'riga', text: 'Riga', currency: 'EUR', rate: 12, moveInMultiplier: 1.3 },
                    { value: 'jurmala', text: 'Jurmala', currency: 'EUR', rate: 10, moveInMultiplier: 1.2 },
                    { value: 'daugavpils', text: 'Daugavpils', currency: 'EUR', rate: 7, moveInMultiplier: 1.0 }
                ]
            },
            uk: {
                name: 'United Kingdom',
                cities: [
                    { value: 'london', text: 'London', currency: 'GBP', rate: 85, moveInMultiplier: 1.6 },
                    { value: 'manchester', text: 'Manchester', currency: 'GBP', rate: 35, moveInMultiplier: 1.3 },
                    { value: 'birmingham', text: 'Birmingham', currency: 'GBP', rate: 30, moveInMultiplier: 1.2 }
                ]
            },
            uzbekistan: {
                name: 'Uzbekistan',
                cities: [
                    { value: 'tashkent', text: 'Tashkent', currency: 'UZS', rate: 150000, moveInMultiplier: 1.1 },
                    { value: 'samarkand', text: 'Samarkand', currency: 'UZS', rate: 100000, moveInMultiplier: 1.0 },
                    { value: 'bukhara', text: 'Bukhara', currency: 'UZS', rate: 80000, moveInMultiplier: 0.9 }
                ]
            },
            cyprus: {
                name: 'Cyprus',
                cities: [
                    { value: 'nicosia', text: 'Nicosia', currency: 'EUR', rate: 14, moveInMultiplier: 1.2 },
                    { value: 'limassol', text: 'Limassol', currency: 'EUR', rate: 18, moveInMultiplier: 1.3 },
                    { value: 'larnaca', text: 'Larnaca', currency: 'EUR', rate: 12, moveInMultiplier: 1.1 }
                ]
            },
            malta: {
                name: 'Malta',
                cities: [
                    { value: 'valletta', text: 'Valletta', currency: 'EUR', rate: 20, moveInMultiplier: 1.4 },
                    { value: 'sliema', text: 'Sliema', currency: 'EUR', rate: 22, moveInMultiplier: 1.5 },
                    { value: 'stpauls', text: "St. Paul's Bay", currency: 'EUR', rate: 15, moveInMultiplier: 1.2 }
                ]
            }
        };

        // Chart instances
        let spaceChart, costChart, projectionChart, headcountChart, capexChart, efficiencyChart;

        // Space matrix data
        let spaceMatrix = [];

        // Update cities dropdown
        function updateCities() {
            const country = document.getElementById('country').value;
            const citySelect = document.getElementById('city');
            citySelect.innerHTML = '<option value="">Select City</option>';
            
            if (country && cityData[country]) {
                cityData[country].cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city.value;
                    option.textContent = city.text;
                    option.dataset.currency = city.currency;
                    option.dataset.rate = city.rate;
                    citySelect.appendChild(option);
                });
            }
            
            calculate();
        }

        // Get total headcount
        function getTotalHeadcount() {
            return (parseInt(document.getElementById('salesCount').value) || 0) +
                   (parseInt(document.getElementById('csCount').value) || 0) +
                   (parseInt(document.getElementById('itCount').value) || 0) +
                   (parseInt(document.getElementById('hrCount').value) || 0) +
                   (parseInt(document.getElementById('financeCount').value) || 0) +
                   (parseInt(document.getElementById('adminCount').value) || 0);
        }

        // Update office defaults
        function updateOfficeDefaults() {
            const countrySelect = document.getElementById('country');
            const citySelect = document.getElementById('city');
            
            if (!countrySelect.value || !citySelect.value) return;
            
            const country = cityData[countrySelect.value];
            const city = country.cities.find(c => c.value === citySelect.value);
            
            if (city) {
                document.getElementById('currency').value = city.currency;
                document.getElementById('rentPerSqm').value = city.rate;
                updateLocationBadge();
                calculate();
            }
        }

        // Update location badge
        function updateLocationBadge() {
            const country = document.getElementById('country');
            const city = document.getElementById('city');
            const currency = document.getElementById('currency');
            
            if (country.value && city.value) {
                const cityObj = cityData[country.value].cities.find(c => c.value === city.value);
                document.getElementById('locationText').textContent = 
                    `${cityObj.text}, ${cityData[country.value].name} (${currency.value})`;
            }
        }

        // Convert to USD
        function convertToUSD(amount, currency) {
            if (currency === 'USD') return amount;
            return amount / exchangeRates[currency];
        }

        // Main calculation function
        function calculate() {
            const totalHeadcount = getTotalHeadcount();
            
            // Calculate space
            const salesSpace = (parseInt(document.getElementById('salesCount').value) || 0) * 
                              (parseFloat(document.getElementById('salesSpace').value) || 0);
            const csSpace = (parseInt(document.getElementById('csCount').value) || 0) * 
                           (parseFloat(document.getElementById('csSpace').value) || 0);
            const itSpace = (parseInt(document.getElementById('itCount').value) || 0) * 
                           (parseFloat(document.getElementById('itSpace').value) || 0);
            const supportSpace = ((parseInt(document.getElementById('hrCount').value) || 0) +
                                 (parseInt(document.getElementById('financeCount').value) || 0) +
                                 (parseInt(document.getElementById('adminCount').value) || 0)) *
                                (parseFloat(document.getElementById('supportSpace').value) || 0);
            
            const workspaceTotal = salesSpace + csSpace + itSpace + supportSpace;
            const commonAreas = workspaceTotal * 0.3; // 30% for common areas
            const circulation = workspaceTotal * 0.15; // 15% for circulation
            const totalArea = workspaceTotal + commonAreas + circulation;
            
            // Calculate office operating costs (OPEX) - NO SALARIES
            const rentPerSqm = parseFloat(document.getElementById('rentPerSqm').value) || 0;
            const monthlyRent = totalArea * rentPerSqm;
            const utilities = parseFloat(document.getElementById('utilities').value) || 0;
            const maintenance = parseFloat(document.getElementById('maintenance').value) || 0;
            const cleaning = parseFloat(document.getElementById('cleaning').value) || 0;
            const security = parseFloat(document.getElementById('security').value) || 0;
            const insurance = parseFloat(document.getElementById('insurance').value) || 0;
            
            // Total monthly office operating cost (OPEX)
            const monthlyTotal = monthlyRent + utilities + maintenance + cleaning + security + insurance;
            
            // Calculate office setup costs (CAPEX)
            const securityDeposit = monthlyRent * (parseInt(document.getElementById('securityDeposit').value) || 3);
            const fitoutCost = totalArea * (parseFloat(document.getElementById('fitoutCost').value) || 0);
            const workstationCost = totalHeadcount * (parseFloat(document.getElementById('workstationCost').value) || 0);
            const itEquipmentCost = totalHeadcount * (parseFloat(document.getElementById('itEquipmentCost').value) || 0);
            const legalFees = parseFloat(document.getElementById('legalFees').value) || 0;
            const contingency = parseFloat(document.getElementById('contingency').value) || 10;
            
            const subtotalMoveIn = securityDeposit + fitoutCost + workstationCost + itEquipmentCost + legalFees;
            const contingencyAmount = subtotalMoveIn * (contingency / 100);
            const totalMoveInCost = subtotalMoveIn + contingencyAmount;
            
            // Get currency
            const currency = document.getElementById('currency').value;
            const currencySymbol = getCurrencySymbol(currency);
            
            // Update KPIs with dual currency display
            updateKPIWithDualCurrency('kpiMonthlyCost', monthlyTotal, currency);
            updateKPIWithDualCurrency('kpiCostPerPerson', totalHeadcount > 0 ? monthlyTotal / totalHeadcount : 0, currency);
            updateKPIWithDualCurrency('kpiMoveInCost', totalMoveInCost, currency);
            
            // Update single value KPIs
            document.getElementById('kpiTotalArea').textContent = totalArea.toFixed(0);
            document.getElementById('kpiHeadcount').textContent = totalHeadcount;
            document.getElementById('kpiEfficiency').textContent = 
                (totalArea > 0 ? (workspaceTotal / totalArea * 100).toFixed(0) : 0) + '%';
            
            // Update cost details with dual currency
            updateKPIWithDualCurrency('totalMoveInCost', totalMoveInCost, currency);
            updateKPIWithDualCurrency('monthlyOperatingCost', monthlyTotal, currency);
            updateKPIWithDualCurrency('annualTCO', monthlyTotal * 12, currency);
            
            // Build space matrix
            buildSpaceMatrix();
            
            // Update charts
            updateCharts();
        }

        // Update KPI with dual currency display
        function updateKPIWithDualCurrency(primaryId, value, currency) {
            const currencySymbol = getCurrencySymbol(currency);
            const primaryElement = document.getElementById(primaryId);
            const usdElement = document.getElementById(primaryId + 'USD');
            
            // Update primary currency display
            if (primaryElement) {
                primaryElement.textContent = currencySymbol + formatNumber(value);
            }
            
            // Update USD display (only if not already USD)
            if (usdElement) {
                if (currency !== 'USD') {
                    const usdValue = convertToUSD(value, currency);
                    usdElement.textContent = '$' + formatNumber(usdValue) + ' USD';
                    usdElement.style.display = 'block';
                } else {
                    usdElement.style.display = 'none'; // Hide if already in USD
                }
            }
        }

        // Get currency symbol
        function getCurrencySymbol(currency) {
            const symbols = {
                'USD': '$',
                'EUR': 'â¬',
                'GBP': 'Â£',
                'AED': 'Ø¯.Ø¥ ',
                'INR': 'â¹',
                'AZN': 'â¼',
                'UZS': "so'm "
            };
            return symbols[currency] || currency + ' ';
        }

        // Format number with thousands separator
        function formatNumber(num) {
            return Math.round(num).toLocaleString('en-IN');
        }

        // Initialize charts
        function initializeCharts() {
            // Space Distribution Chart
            const spaceCtx = document.getElementById('spaceChart');
            if (spaceCtx) {
                spaceChart = new Chart(spaceCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Sales', 'Customer Support', 'IT', 'Support Functions', 'Common Areas'],
                        datasets: [{
                            data: [750, 105, 350, 174, 621],
                            backgroundColor: [
                                '#3b82f6',
                                '#10b981',
                                '#8b5cf6',
                                '#f59e0b',
                                '#64748b'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            // Office OPEX Breakdown Chart (NO SALARIES)
            const costCtx = document.getElementById('costChart');
            if (costCtx) {
                costChart = new Chart(costCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Rent', 'Utilities', 'Maintenance', 'Cleaning', 'Security', 'Insurance'],
                        datasets: [{
                            label: 'Monthly Office Cost',
                            data: [0, 0, 0, 0, 0, 0],
                            backgroundColor: ['#6366f1', '#14b8a6', '#f59e0b', '#10b981', '#8b5cf6', '#ef4444']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return getCurrencySymbol(document.getElementById('currency').value) + 
                                               formatNumber(value);
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Office Cost Projection Chart
            const projCtx = document.getElementById('projectionChart');
            if (projCtx) {
                projectionChart = new Chart(projCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5'],
                        datasets: [{
                            label: 'Office Cost',
                            data: [0, 0, 0, 0, 0],
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return getCurrencySymbol(document.getElementById('currency').value) + 
                                               formatNumber(value);
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Headcount Chart
            const headCtx = document.getElementById('headcountChart');
            if (headCtx) {
                headcountChart = new Chart(headCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Sales', 'CS', 'IT', 'HR', 'Finance', 'Admin'],
                        datasets: [{
                            label: 'Headcount',
                            data: [250, 30, 70, 14, 8, 7],
                            backgroundColor: '#6366f1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // CAPEX Distribution Chart
            const capexCtx = document.getElementById('capexChart');
            if (capexCtx) {
                capexChart = new Chart(capexCtx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: ['Security Deposit', 'Fitout', 'Furniture', 'IT Infrastructure', 'Legal & Fees'],
                        datasets: [{
                            data: [0, 0, 0, 0, 0],
                            backgroundColor: [
                                '#3b82f6',
                                '#10b981',
                                '#f59e0b',
                                '#8b5cf6',
                                '#ef4444'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            // Efficiency Chart
            const effCtx = document.getElementById('efficiencyChart');
            if (effCtx) {
                efficiencyChart = new Chart(effCtx.getContext('2d'), {
                    type: 'radar',
                    data: {
                        labels: ['Space Efficiency', 'Cost Efficiency', 'Density', 'Flexibility', 'Sustainability'],
                        datasets: [{
                            label: 'Current Office',
                            data: [70, 65, 75, 80, 60],
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.2)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }
        }

        // Update charts function
        function updateCharts() {
            const currency = document.getElementById('currency').value;
            
            // Update space distribution
            if (spaceChart) {
                const salesSpace = (parseInt(document.getElementById('salesCount').value) || 0) * 
                                  (parseFloat(document.getElementById('salesSpace').value) || 0);
                const csSpace = (parseInt(document.getElementById('csCount').value) || 0) * 
                               (parseFloat(document.getElementById('csSpace').value) || 0);
                const itSpace = (parseInt(document.getElementById('itCount').value) || 0) * 
                               (parseFloat(document.getElementById('itSpace').value) || 0);
                const supportSpace = ((parseInt(document.getElementById('hrCount').value) || 0) +
                                     (parseInt(document.getElementById('financeCount').value) || 0) +
                                     (parseInt(document.getElementById('adminCount').value) || 0)) *
                                    (parseFloat(document.getElementById('supportSpace').value) || 0);
                const commonSpace = (salesSpace + csSpace + itSpace + supportSpace) * 0.45;
                
                spaceChart.data.datasets[0].data = [
                    salesSpace,
                    csSpace,
                    itSpace,
                    supportSpace,
                    commonSpace
                ];
                spaceChart.update();
            }
            
            // Update office OPEX breakdown (NO SALARIES)
            if (costChart) {
                const totalArea = parseFloat(document.getElementById('kpiTotalArea').textContent) || 0;
                const rentPerSqm = parseFloat(document.getElementById('rentPerSqm').value) || 0;
                const monthlyRent = totalArea * rentPerSqm;
                
                costChart.data.datasets[0].data = [
                    monthlyRent,
                    parseFloat(document.getElementById('utilities').value) || 0,
                    parseFloat(document.getElementById('maintenance').value) || 0,
                    parseFloat(document.getElementById('cleaning').value) || 0,
                    parseFloat(document.getElementById('security').value) || 0,
                    parseFloat(document.getElementById('insurance').value) || 0
                ];
                costChart.update();
            }
            
            // Update projection chart (office costs only with 5% annual increase)
            if (projectionChart) {
                const monthlyTotal = parseFloat(document.getElementById('utilities').value) || 0 +
                                   parseFloat(document.getElementById('maintenance').value) || 0 +
                                   parseFloat(document.getElementById('cleaning').value) || 0 +
                                   parseFloat(document.getElementById('security').value) || 0 +
                                   parseFloat(document.getElementById('insurance').value) || 0;
                
                const totalArea = parseFloat(document.getElementById('kpiTotalArea').textContent) || 0;
                const rentPerSqm = parseFloat(document.getElementById('rentPerSqm').value) || 0;
                const monthlyRent = totalArea * rentPerSqm;
                const baseYearlyCost = (monthlyRent + monthlyTotal) * 12;
                
                const projectionData = [];
                for (let i = 0; i < 5; i++) {
                    projectionData.push(baseYearlyCost * Math.pow(1.05, i)); // 5% annual increase
                }
                
                projectionChart.data.datasets[0].data = projectionData;
                projectionChart.update();
            }
            
            // Update headcount chart
            if (headcountChart) {
                headcountChart.data.datasets[0].data = [
                    parseInt(document.getElementById('salesCount').value) || 0,
                    parseInt(document.getElementById('csCount').value) || 0,
                    parseInt(document.getElementById('itCount').value) || 0,
                    parseInt(document.getElementById('hrCount').value) || 0,
                    parseInt(document.getElementById('financeCount').value) || 0,
                    parseInt(document.getElementById('adminCount').value) || 0
                ];
                headcountChart.update();
            }
            
            // Update CAPEX distribution
            if (capexChart) {
                const totalArea = parseFloat(document.getElementById('kpiTotalArea').textContent) || 0;
                const totalHeadcount = getTotalHeadcount();
                const rentPerSqm = parseFloat(document.getElementById('rentPerSqm').value) || 0;
                const monthlyRent = totalArea * rentPerSqm;
                
                capexChart.data.datasets[0].data = [
                    monthlyRent * (parseInt(document.getElementById('securityDeposit').value) || 3),
                    totalArea * (parseFloat(document.getElementById('fitoutCost').value) || 0),
                    totalHeadcount * (parseFloat(document.getElementById('workstationCost').value) || 0),
                    totalHeadcount * (parseFloat(document.getElementById('itEquipmentCost').value) || 0),
                    parseFloat(document.getElementById('legalFees').value) || 0
                ];
                capexChart.update();
            }
        }

        // Tab switching
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').style.display = 'block';
            
            // Add active class to clicked button
            event.target.closest('.tab-btn').classList.add('active');
            
            // Update charts if analytics tab
            if (tabName === 'analytics') {
                setTimeout(() => {
                    updateCharts();
                }, 100);
            }
        }

        // Space matrix with area grouping
        let spaceGroups = {};
        
        // Initialize default groups
        function initializeSpaceGroups() {
            spaceGroups = {
                'Workspaces': [
                    { type: 'Sales Workstations (ITN+SLT+OOJO)', count: 250, size: 3, total: 750 },
                    { type: 'CS Workstations', count: 30, size: 3.5, total: 105 },
                    { type: 'IT Workstations', count: 70, size: 5, total: 350 },
                    { type: 'Manager Cabins', count: 10, size: 10, total: 100 }
                ],
                'Meeting & Conference': [
                    { type: 'Training Room (30 seats)', count: 1, size: 60, total: 60 },
                    { type: 'Conference Room - Large (25 seats)', count: 1, size: 50, total: 50 },
                    { type: 'Conference Room - Sales (18 seats)', count: 2, size: 36, total: 72 },
                    { type: 'Conference Room - Medium (10 seats)', count: 1, size: 20, total: 20 },
                    { type: 'Meeting Rooms (4 pax)', count: 4, size: 12, total: 48 }
                ],
                'Support Services': [
                    { type: 'HR Hiring Room (4 seats)', count: 1, size: 16, total: 16 },
                    { type: 'HR Support Room (6 seats)', count: 1, size: 20, total: 20 },
                    { type: 'BHR Room (4 seats)', count: 1, size: 16, total: 16 },
                    { type: 'Finance Room (4 seats)', count: 1, size: 16, total: 16 },
                    { type: 'Facility Room (4 seats)', count: 1, size: 16, total: 16 },
                    { type: 'Security Room (2 seats)', count: 1, size: 10, total: 10 },
                    { type: 'Transport Room (5 seats)', count: 1, size: 18, total: 18 }
                ],
                'Employee Facilities': [
                    { type: 'Cafeteria (50 seats)', count: 1, size: 100, total: 100 },
                    { type: 'Medical Room (2 beds)', count: 1, size: 20, total: 20 },
                    { type: 'Pantry Shop', count: 1, size: 15, total: 15 }
                ],
                'Infrastructure & Storage': [
                    { type: 'Server Room', count: 1, size: 30, total: 30 },
                    { type: 'Storage Rooms', count: 3, size: 10, total: 30 },
                    { type: 'Dishwash Room', count: 1, size: 10, total: 10 }
                ],
                'Common Areas': [
                    { type: 'Reception', count: 1, size: 30, total: 30 },
                    { type: 'Washroom Ladies (10 WC)', count: 1, size: 40, total: 40 },
                    { type: 'Washroom Gents (10 WC)', count: 1, size: 40, total: 40 },
                    { type: 'Handicap Washroom', count: 1, size: 8, total: 8 }
                ]
            };
            
            // Flatten for backward compatibility
            updateSpaceMatrixFromGroups();
        }
        
        // Flatten groups to matrix for calculations
        function updateSpaceMatrixFromGroups() {
            spaceMatrix = [];
            for (const group in spaceGroups) {
                spaceMatrix = spaceMatrix.concat(spaceGroups[group]);
            }
        }
        
        // Build space matrix with groups
        function buildSpaceMatrix() {
            const container = document.getElementById('spaceMatrixContainer');
            if (!container) return;
            
            // Initialize if empty
            if (Object.keys(spaceGroups).length === 0) {
                initializeSpaceGroups();
            }
            
            let html = `
                <div class="space-matrix-grouped">
            `;
            
            let groupIndex = 0;
            for (const [groupName, spaces] of Object.entries(spaceGroups)) {
                const groupTotal = spaces.reduce((sum, space) => sum + space.total, 0);
                const groupColor = ['#6366f1', '#14b8a6', '#f59e0b', '#8b5cf6', '#ef4444', '#22c55e'][groupIndex % 6];
                
                html += `
                    <div class="space-group" style="border-left: 4px solid ${groupColor}; margin-bottom: 1.5rem;">
                        <div class="group-header" style="background: linear-gradient(90deg, ${groupColor}15 0%, transparent 100%); padding: 1rem; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <input type="text" value="${groupName}" 
                                       style="font-weight: 600; font-size: 1.125rem; background: transparent; border: none; color: #1f2937;"
                                       onchange="renameGroup('${groupName}', this.value)">
                                <span style="background: ${groupColor}; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.875rem;">
                                    ${spaces.length} spaces | ${groupTotal} sq m
                                </span>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-sm" style="background: ${groupColor}; color: white; padding: 0.5rem 1rem; border-radius: 6px;"
                                        onclick="addSpaceToGroup('${groupName}')">
                                    <i class="fas fa-plus"></i> Add Space
                                </button>
                                <button class="btn btn-sm btn-danger" style="padding: 0.5rem 1rem; border-radius: 6px;"
                                        onclick="removeGroup('${groupName}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <table class="matrix-table" style="margin-bottom: 0;">
                            <thead>
                                <tr>
                                    <th>Space Type</th>
                                    <th>Quantity</th>
                                    <th>Size (sq m)</th>
                                    <th>Total (sq m)</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                spaces.forEach((row, index) => {
                    html += `
                        <tr>
                            <td><input type="text" value="${row.type}" onchange="updateGroupSpace('${groupName}', ${index}, 'type', this.value)"></td>
                            <td><input type="number" value="${row.count}" onchange="updateGroupSpace('${groupName}', ${index}, 'count', this.value)"></td>
                            <td><input type="number" value="${row.size}" step="0.5" onchange="updateGroupSpace('${groupName}', ${index}, 'size', this.value)"></td>
                            <td style="font-weight: 500;">${row.total}</td>
                            <td>
                                <button class="btn btn-sm btn-danger" onclick="removeSpaceFromGroup('${groupName}', ${index})">
                                    <i class="fas fa-times"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
                groupIndex++;
            }
            
            // Add summary section
            const grandTotal = spaceMatrix.reduce((sum, space) => sum + space.total, 0);
            html += `
                <div class="space-summary" style="background: var(--gradient-primary); color: white; padding: 1.5rem; border-radius: 12px; margin-top: 2rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="margin: 0; font-size: 1.25rem;">Total Space Allocation</h3>
                            <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">
                                ${Object.keys(spaceGroups).length} areas | ${spaceMatrix.length} spaces
                            </p>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 2rem; font-weight: 700;">${grandTotal} sq m</div>
                            <div style="opacity: 0.9;">${(grandTotal * 10.764).toFixed(0)} sq ft</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 1rem;">
                    <button class="btn btn-primary" onclick="addNewGroup()">
                        <i class="fas fa-folder-plus"></i> Add New Area Group
                    </button>
                </div>
            </div>
            `;
            
            container.innerHTML = html;
        }
        
        // Group management functions
        function renameGroup(oldName, newName) {
            if (newName && newName !== oldName && !spaceGroups[newName]) {
                spaceGroups[newName] = spaceGroups[oldName];
                delete spaceGroups[oldName];
                buildSpaceMatrix();
                calculate();
            }
        }
        
        function addNewGroup() {
            const name = prompt('Enter name for new area group:');
            if (name && !spaceGroups[name]) {
                spaceGroups[name] = [];
                buildSpaceMatrix();
                showNotification('New area group added!', 'success');
            }
        }
        
        function removeGroup(groupName) {
            if (confirm(`Remove area group "${groupName}" and all its spaces?`)) {
                delete spaceGroups[groupName];
                updateSpaceMatrixFromGroups();
                buildSpaceMatrix();
                calculate();
                showNotification('Area group removed', 'success');
            }
        }
        
        function addSpaceToGroup(groupName) {
            spaceGroups[groupName].push({
                type: 'New Space',
                count: 1,
                size: 10,
                total: 10
            });
            updateSpaceMatrixFromGroups();
            buildSpaceMatrix();
            calculate();
        }
        
        function removeSpaceFromGroup(groupName, index) {
            spaceGroups[groupName].splice(index, 1);
            updateSpaceMatrixFromGroups();
            buildSpaceMatrix();
            calculate();
        }
        
        function updateGroupSpace(groupName, index, field, value) {
            const space = spaceGroups[groupName][index];
            space[field] = field === 'type' ? value : parseFloat(value) || 0;
            space.total = space.count * space.size;
            updateSpaceMatrixFromGroups();
            buildSpaceMatrix();
            calculate();
        }
        
        // Update old functions for compatibility
        function updateSpaceMatrix(index, field, value) {
            // Find which group contains this index
            let currentIndex = 0;
            for (const [groupName, spaces] of Object.entries(spaceGroups)) {
                if (currentIndex + spaces.length > index) {
                    const localIndex = index - currentIndex;
                    updateGroupSpace(groupName, localIndex, field, value);
                    return;
                }
                currentIndex += spaces.length;
            }
        }
        
        function addSpaceRow() {
            // Add to first group or create one if none exist
            const groups = Object.keys(spaceGroups);
            if (groups.length > 0) {
                addSpaceToGroup(groups[0]);
            } else {
                addNewGroup();
            }
        }
        
        function removeSpaceRow(index) {
            // Find which group contains this index
            let currentIndex = 0;
            for (const [groupName, spaces] of Object.entries(spaceGroups)) {
                if (currentIndex + spaces.length > index) {
                    const localIndex = index - currentIndex;
                    removeSpaceFromGroup(groupName, localIndex);
                    return;
                }
                currentIndex += spaces.length;
            }
        }
        
        // Reset space groups to default
        function resetSpaceGroups() {
            if (confirm('Reset space matrix to default India call center configuration?')) {
                initializeSpaceGroups();
                buildSpaceMatrix();
                calculate();
                showNotification('Space matrix reset to default', 'success');
            }
        }

        // Update space matrix
        function updateSpaceMatrix(index, field, value) {
            spaceMatrix[index][field] = field === 'type' ? value : parseFloat(value) || 0;
            spaceMatrix[index].total = spaceMatrix[index].count * spaceMatrix[index].size;
            buildSpaceMatrix();
        }

        // Add space row
        function addSpaceRow() {
            spaceMatrix.push({ type: 'New Space', count: 0, size: 0, total: 0 });
            buildSpaceMatrix();
        }

        // Remove space row
        function removeSpaceRow(index) {
            spaceMatrix.splice(index, 1);
            buildSpaceMatrix();
        }

        // Apply template
        function applyTemplate() {
            const templates = {
                'India Call Center': {
                    'Workspaces': [
                        { type: 'Sales Workstations (ITN+SLT+OOJO)', count: 250, size: 3, total: 750 },
                        { type: 'CS Workstations', count: 30, size: 3.5, total: 105 },
                        { type: 'IT Workstations', count: 70, size: 5, total: 350 },
                        { type: 'Manager Cabins', count: 10, size: 10, total: 100 }
                    ],
                    'Meeting & Conference': [
                        { type: 'Training Room (30 seats)', count: 1, size: 60, total: 60 },
                        { type: 'Conference Room - Large (25 seats)', count: 1, size: 50, total: 50 },
                        { type: 'Conference Room - Sales (18 seats)', count: 2, size: 36, total: 72 },
                        { type: 'Conference Room - Medium (10 seats)', count: 1, size: 20, total: 20 },
                        { type: 'Meeting Rooms (4 pax)', count: 4, size: 12, total: 48 }
                    ],
                    'Support Services': [
                        { type: 'HR Hiring Room (4 seats)', count: 1, size: 16, total: 16 },
                        { type: 'HR Support Room (6 seats)', count: 1, size: 20, total: 20 },
                        { type: 'BHR Room (4 seats)', count: 1, size: 16, total: 16 },
                        { type: 'Finance Room (4 seats)', count: 1, size: 16, total: 16 },
                        { type: 'Facility Room (4 seats)', count: 1, size: 16, total: 16 },
                        { type: 'Security Room (2 seats)', count: 1, size: 10, total: 10 },
                        { type: 'Transport Room (5 seats)', count: 1, size: 18, total: 18 }
                    ],
                    'Employee Facilities': [
                        { type: 'Cafeteria (50 seats)', count: 1, size: 100, total: 100 },
                        { type: 'Medical Room (2 beds)', count: 1, size: 20, total: 20 },
                        { type: 'Pantry Shop', count: 1, size: 15, total: 15 }
                    ],
                    'Infrastructure & Storage': [
                        { type: 'Server Room', count: 1, size: 30, total: 30 },
                        { type: 'Storage Rooms', count: 3, size: 10, total: 30 },
                        { type: 'Dishwash Room', count: 1, size: 10, total: 10 }
                    ],
                    'Common Areas': [
                        { type: 'Reception', count: 1, size: 30, total: 30 },
                        { type: 'Washroom Ladies (10 WC)', count: 1, size: 40, total: 40 },
                        { type: 'Washroom Gents (10 WC)', count: 1, size: 40, total: 40 },
                        { type: 'Handicap Washroom', count: 1, size: 8, total: 8 }
                    ]
                },
                'Tech Startup': {
                    'Workspaces': [
                        { type: 'Open Workspace', count: 150, size: 5, total: 750 },
                        { type: 'Hot Desks', count: 50, size: 3, total: 150 }
                    ],
                    'Collaboration': [
                        { type: 'Phone Booths', count: 20, size: 2, total: 40 },
                        { type: 'Collaboration Zones', count: 5, size: 30, total: 150 },
                        { type: 'Meeting Pods', count: 10, size: 6, total: 60 }
                    ],
                    'Amenities': [
                        { type: 'Game Room', count: 1, size: 50, total: 50 },
                        { type: 'Wellness Room', count: 1, size: 30, total: 30 },
                        { type: 'Kitchen & Dining', count: 1, size: 80, total: 80 }
                    ],
                    'Support': [
                        { type: 'Server Room', count: 1, size: 20, total: 20 },
                        { type: 'Storage', count: 2, size: 10, total: 20 },
                        { type: 'Reception', count: 1, size: 25, total: 25 }
                    ]
                },
                'Corporate Office': {
                    'Executive': [
                        { type: 'Executive Offices', count: 10, size: 20, total: 200 },
                        { type: 'Executive Assistants', count: 10, size: 8, total: 80 }
                    ],
                    'Workspaces': [
                        { type: 'Workstations', count: 200, size: 6, total: 1200 },
                        { type: 'Manager Offices', count: 20, size: 12, total: 240 }
                    ],
                    'Meeting Facilities': [
                        { type: 'Board Room', count: 1, size: 80, total: 80 },
                        { type: 'Meeting Rooms', count: 15, size: 15, total: 225 },
                        { type: 'Training Room', count: 2, size: 60, total: 120 }
                    ],
                    'Support': [
                        { type: 'Reception & Lobby', count: 1, size: 60, total: 60 },
                        { type: 'Mail Room', count: 1, size: 30, total: 30 },
                        { type: 'Copy Centers', count: 3, size: 15, total: 45 }
                    ]
                }
            };
            
            // Simple template selection (in production, use a modal)
            const selected = prompt('Select template:\n1. India Call Center (High Density)\n2. Tech Startup\n3. Corporate Office');
            const templateNames = ['India Call Center', 'Tech Startup', 'Corporate Office'];
            
            if (selected && templates[templateNames[parseInt(selected) - 1]]) {
                spaceGroups = templates[templateNames[parseInt(selected) - 1]];
                updateSpaceMatrixFromGroups();
                buildSpaceMatrix();
                calculate();
                showNotification('Template applied successfully!', 'success');
            }
        }

        // Show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            document.body.appendChild(notification);
            notification.style.display = 'flex';
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Export data
        function exportData() {
            const currency = document.getElementById('currency').value;
            const data = {
                location: {
                    country: document.getElementById('country').value,
                    city: document.getElementById('city').value,
                    currency: currency
                },
                headcount: {
                    sales: parseInt(document.getElementById('salesCount').value) || 0,
                    cs: parseInt(document.getElementById('csCount').value) || 0,
                    it: parseInt(document.getElementById('itCount').value) || 0,
                    support: {
                        hr: parseInt(document.getElementById('hrCount').value) || 0,
                        finance: parseInt(document.getElementById('financeCount').value) || 0,
                        admin: parseInt(document.getElementById('adminCount').value) || 0
                    }
                },
                costs: {
                    opex: {
                        rent: parseFloat(document.getElementById('rentPerSqm').value) || 0,
                        utilities: parseFloat(document.getElementById('utilities').value) || 0,
                        maintenance: parseFloat(document.getElementById('maintenance').value) || 0,
                        cleaning: parseFloat(document.getElementById('cleaning').value) || 0,
                        security: parseFloat(document.getElementById('security').value) || 0,
                        insurance: parseFloat(document.getElementById('insurance').value) || 0
                    },
                    capex: {
                        securityDeposit: parseInt(document.getElementById('securityDeposit').value) || 0,
                        fitoutCost: parseFloat(document.getElementById('fitoutCost').value) || 0,
                        workstationCost: parseFloat(document.getElementById('workstationCost').value) || 0,
                        itEquipmentCost: parseFloat(document.getElementById('itEquipmentCost').value) || 0,
                        legalFees: parseFloat(document.getElementById('legalFees').value) || 0,
                        contingency: parseFloat(document.getElementById('contingency').value) || 0
                    }
                },
                spaceGroups: spaceGroups,
                spaceMatrix: spaceMatrix,
                summary: {
                    totalArea: parseFloat(document.getElementById('kpiTotalArea').textContent) || 0,
                    totalHeadcount: getTotalHeadcount(),
                    monthlyOpex: document.getElementById('kpiMonthlyCost').textContent,
                    totalCapex: document.getElementById('kpiMoveInCost').textContent
                },
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `office-plan-${new Date().getTime()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Data exported successfully!', 'success');
        }

        // Generate comprehensive report
        function generateReport() {
            const currency = document.getElementById('currency').value;
            const currencySymbol = getCurrencySymbol(currency);
            const country = document.getElementById('country').value;
            const city = document.getElementById('city').value;
            const cityObj = country && city ? cityData[country].cities.find(c => c.value === city) : null;
            const location = cityObj ? `${cityObj.text}, ${cityData[country].name}` : 'Not Selected';
            
            // Get all values
            const totalHeadcount = getTotalHeadcount();
            const salesCount = parseInt(document.getElementById('salesCount').value) || 0;
            const csCount = parseInt(document.getElementById('csCount').value) || 0;
            const itCount = parseInt(document.getElementById('itCount').value) || 0;
            const hrCount = parseInt(document.getElementById('hrCount').value) || 0;
            const financeCount = parseInt(document.getElementById('financeCount').value) || 0;
            const adminCount = parseInt(document.getElementById('adminCount').value) || 0;
            
            const totalArea = parseFloat(document.getElementById('kpiTotalArea').textContent) || 0;
            
            // Get costs
            const rentPerSqm = parseFloat(document.getElementById('rentPerSqm').value) || 0;
            const monthlyRent = totalArea * rentPerSqm;
            const utilities = parseFloat(document.getElementById('utilities').value) || 0;
            const maintenance = parseFloat(document.getElementById('maintenance').value) || 0;
            const cleaning = parseFloat(document.getElementById('cleaning').value) || 0;
            const security = parseFloat(document.getElementById('security').value) || 0;
            const insurance = parseFloat(document.getElementById('insurance').value) || 0;
            const monthlyOpex = monthlyRent + utilities + maintenance + cleaning + security + insurance;
            
            const securityDeposit = monthlyRent * (parseInt(document.getElementById('securityDeposit').value) || 3);
            const fitoutCost = totalArea * (parseFloat(document.getElementById('fitoutCost').value) || 0);
            const workstationCost = totalHeadcount * (parseFloat(document.getElementById('workstationCost').value) || 0);
            const itEquipmentCost = totalHeadcount * (parseFloat(document.getElementById('itEquipmentCost').value) || 0);
            const legalFees = parseFloat(document.getElementById('legalFees').value) || 0;
            const contingency = parseFloat(document.getElementById('contingency').value) || 10;
            const subtotalCapex = securityDeposit + fitoutCost + workstationCost + itEquipmentCost + legalFees;
            const contingencyAmount = subtotalCapex * (contingency / 100);
            const totalCapex = subtotalCapex + contingencyAmount;
            
            // Generate HTML report
            const reportHTML = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Office Space Requirements Report - ${location}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Arial', sans-serif; 
            line-height: 1.6; 
            color: #333; 
            background: #f4f4f4;
            padding: 20px;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 40px; 
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .header { 
            text-align: center; 
            padding: 30px 0; 
            border-bottom: 3px solid #6366f1; 
            margin-bottom: 30px;
        }
        .header h1 { 
            color: #6366f1; 
            font-size: 2.5em; 
            margin-bottom: 10px;
        }
        .header p { 
            color: #666; 
            font-size: 1.2em;
        }
        .section { 
            margin: 30px 0; 
            padding: 20px; 
            background: #f9f9f9; 
            border-radius: 10px;
        }
        .section-title { 
            color: #6366f1; 
            font-size: 1.8em; 
            margin-bottom: 20px; 
            border-bottom: 2px solid #6366f1; 
            padding-bottom: 10px;
        }
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
            margin: 20px 0;
        }
        .metric { 
            padding: 15px; 
            background: white; 
            border-radius: 8px; 
            border-left: 4px solid #6366f1;
        }
        .metric-label { 
            color: #666; 
            font-size: 0.9em; 
            text-transform: uppercase; 
            margin-bottom: 5px;
        }
        .metric-value { 
            color: #333; 
            font-size: 1.5em; 
            font-weight: bold;
        }
        .metric-subvalue { 
            color: #999; 
            font-size: 0.85em; 
            margin-top: 3px;
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 20px 0;
        }
        th, td { 
            padding: 12px; 
            text-align: left; 
            border-bottom: 1px solid #ddd;
        }
        th { 
            background: #6366f1; 
            color: white; 
            font-weight: bold;
        }
        tr:hover { background: #f5f5f5; }
        .highlight { 
            background: #fffacd; 
            padding: 15px; 
            border-left: 4px solid #f59e0b; 
            margin: 20px 0;
        }
        .footer { 
            text-align: center; 
            margin-top: 40px; 
            padding-top: 20px; 
            border-top: 2px solid #eee; 
            color: #666;
        }
        @media print {
            body { padding: 0; background: white; }
            .container { box-shadow: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Office Space Requirements Report</h1>
            <p>${location} | ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
        </div>

        <div class="section">
            <h2 class="section-title">Executive Summary</h2>
            <div class="grid">
                <div class="metric">
                    <div class="metric-label">Total Office Area</div>
                    <div class="metric-value">${totalArea.toFixed(0)} sq m</div>
                    <div class="metric-subvalue">${(totalArea * 10.764).toFixed(0)} sq ft</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Total Headcount</div>
                    <div class="metric-value">${totalHeadcount}</div>
                    <div class="metric-subvalue">employees</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Monthly OPEX</div>
                    <div class="metric-value">${currencySymbol}${formatNumber(monthlyOpex)}</div>
                    ${currency !== 'USD' ? `<div class="metric-subvalue">$${formatNumber(convertToUSD(monthlyOpex, currency))} USD</div>` : ''}
                </div>
                <div class="metric">
                    <div class="metric-label">Total CAPEX</div>
                    <div class="metric-value">${currencySymbol}${formatNumber(totalCapex)}</div>
                    ${currency !== 'USD' ? `<div class="metric-subvalue">$${formatNumber(convertToUSD(totalCapex, currency))} USD</div>` : ''}
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">Headcount Distribution</h2>
            <table>
                <thead>
                    <tr>
                        <th>Department</th>
                        <th>Headcount</th>
                        <th>Space per Person (sq m)</th>
                        <th>Total Space (sq m)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Sales (ITN+SLT+OOJO)</td>
                        <td>${salesCount}</td>
                        <td>${document.getElementById('salesSpace').value}</td>
                        <td>${(salesCount * parseFloat(document.getElementById('salesSpace').value)).toFixed(0)}</td>
                    </tr>
                    <tr>
                        <td>Customer Support</td>
                        <td>${csCount}</td>
                        <td>${document.getElementById('csSpace').value}</td>
                        <td>${(csCount * parseFloat(document.getElementById('csSpace').value)).toFixed(0)}</td>
                    </tr>
                    <tr>
                        <td>IT</td>
                        <td>${itCount}</td>
                        <td>${document.getElementById('itSpace').value}</td>
                        <td>${(itCount * parseFloat(document.getElementById('itSpace').value)).toFixed(0)}</td>
                    </tr>
                    <tr>
                        <td>HR</td>
                        <td>${hrCount}</td>
                        <td rowspan="3">${document.getElementById('supportSpace').value}</td>
                        <td rowspan="3">${((hrCount + financeCount + adminCount) * parseFloat(document.getElementById('supportSpace').value)).toFixed(0)}</td>
                    </tr>
                    <tr>
                        <td>Finance</td>
                        <td>${financeCount}</td>
                    </tr>
                    <tr>
                        <td>Admin</td>
                        <td>${adminCount}</td>
                    </tr>
                    <tr style="font-weight: bold;">
                        <td>TOTAL</td>
                        <td>${totalHeadcount}</td>
                        <td>-</td>
                        <td>${totalArea.toFixed(0)}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2 class="section-title">Space Allocation by Area</h2>
            ${Object.entries(spaceGroups).map(([groupName, spaces]) => {
                const groupTotal = spaces.reduce((sum, space) => sum + space.total, 0);
                return `
                <div style="margin-bottom: 2rem;">
                    <h3 style="color: #6366f1; font-size: 1.3em; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid #e2e8f0;">
                        ${groupName}
                        <span style="float: right; font-size: 0.9em; color: #666;">
                            ${spaces.length} spaces | ${groupTotal} sq m
                        </span>
                    </h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Space Type</th>
                                <th>Quantity</th>
                                <th>Unit Size (sq m)</th>
                                <th>Total Area (sq m)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${spaces.map(row => `
                            <tr>
                                <td>${row.type}</td>
                                <td>${row.count}</td>
                                <td>${row.size}</td>
                                <td>${row.total}</td>
                            </tr>
                            `).join('')}
                            <tr style="font-weight: bold; background: #f0f0f0;">
                                <td colspan="3">Subtotal</td>
                                <td>${groupTotal}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                `;
            }).join('')}
            <div style="background: #6366f1; color: white; padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                <strong>TOTAL ALLOCATED SPACE:</strong> 
                <span style="float: right; font-size: 1.2em;">
                    ${spaceMatrix.reduce((sum, row) => sum + row.total, 0)} sq m 
                    (${(spaceMatrix.reduce((sum, row) => sum + row.total, 0) * 10.764).toFixed(0)} sq ft)
                </span>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">Monthly Operating Costs (OPEX)</h2>
            <table>
                <thead>
                    <tr>
                        <th>Cost Component</th>
                        <th>Monthly Amount (${currency})</th>
                        ${currency !== 'USD' ? '<th>Monthly Amount (USD)</th>' : ''}
                        <th>Annual Amount (${currency})</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Office Rent</td>
                        <td>${currencySymbol}${formatNumber(monthlyRent)}</td>
                        ${currency !== 'USD' ? `<td>$${formatNumber(convertToUSD(monthlyRent, currency))}</td>` : ''}
                        <td>${currencySymbol}${formatNumber(monthlyRent * 12)}</td>
                    </tr>
                    <tr>
                        <td>Utilities</td>
                        <td>${currencySymbol}${formatNumber(utilities)}</td>
                        ${currency !== 'USD' ? `<td>$${formatNumber(convertToUSD(utilities, currency))}</td>` : ''}
                        <td>${currencySymbol}${formatNumber(utilities * 12)}</td>
                    </tr>
                    <tr>
                        <td>Maintenance</td>
                        <td>${currencySymbol}${formatNumber(maintenance)}</td>
                        ${currency !== 'USD' ? `<td>$${formatNumber(convertToUSD(maintenance, currency))}</td>` : ''}
                        <td>${currencySymbol}${formatNumber(maintenance * 12)}</td>
                    </tr>
                    <tr>
                        <td>Cleaning Services</td>
                        <td>${currencySymbol}${formatNumber(cleaning)}</td>
                        ${currency !== 'USD' ? `<td>$${formatNumber(convertToUSD(cleaning, currency))}</td>` : ''}
                        <td>${currencySymbol}${formatNumber(cleaning * 12)}</td>
                    </tr>
                    <tr>
                        <td>Security Services</td>
                        <td>${currencySymbol}${formatNumber(security)}</td>
                        ${currency !== 'USD' ? `<td>$${formatNumber(convertToUSD(security, currency))}</td>` : ''}
                        <td>${currencySymbol}${formatNumber(security * 12)}</td>
                    </tr>
                    <tr>
                        <td>Insurance</td>
                        <td>${currencySymbol}${formatNumber(insurance)}</td>
                        ${currency !== 'USD' ? `<td>$${formatNumber(convertToUSD(insurance, currency))}</td>` : ''}
                        <td>${currencySymbol}${formatNumber(insurance * 12)}</td>
                    </tr>
                    <tr style="font-weight: bold; background: #f0f0f0;">
                        <td>TOTAL OPEX</td>
                        <td>${currencySymbol}${formatNumber(monthlyOpex)}</td>
                        ${currency !== 'USD' ? `<td>$${formatNumber(convertToUSD(monthlyOpex, currency))}</td>` : ''}
                        <td>${currencySymbol}${formatNumber(monthlyOpex * 12)}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2 class="section-title">Capital Expenditure (CAPEX)</h2>
            <table>
                <thead>
                    <tr>
                        <th>Investment Component</th>
                        <th>Amount (${currency})</th>
                        ${currency !== 'USD' ? '<th>Amount (USD)</th>' : ''}
                        <th>% of Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Security Deposit (${document.getElementById('securityDeposit').value} months)</td>
                        <td>${currencySymbol}${formatNumber(securityDeposit)}</td>
                        ${currency !== 'USD' ? `<td>$${formatNumber(convertToUSD(securityDeposit, currency))}</td>` : ''}
                        <td>${((securityDeposit / totalCapex) * 100).toFixed(1)}%</td>
                    </tr>
                    <tr>
                        <td>Interior Fitout (${totalArea.toFixed(0)} sq m @ ${currencySymbol}${document.getElementById('fitoutCost').value}/sq m)</td>
                        <td>${currencySymbol}${formatNumber(fitoutCost)}</td>
                        ${currency !== 'USD' ? `<td>$${formatNumber(convertToUSD(fitoutCost, currency))}</td>` : ''}
                        <td>${((fitoutCost / totalCapex) * 100).toFixed(1)}%</td>
                    </tr>
                    <tr>
                        <td>Furniture & Workstations (${totalHeadcount} @ ${currencySymbol}${document.getElementById('workstationCost').value})</td>
                        <td>${currencySymbol}${formatNumber(workstationCost)}</td>
                        ${currency !== 'USD' ? `<td>$${formatNumber(convertToUSD(workstationCost, currency))}</td>` : ''}
                        <td>${((workstationCost / totalCapex) * 100).toFixed(1)}%</td>
                    </tr>
                    <tr>
                        <td>IT Infrastructure (${totalHeadcount} @ ${currencySymbol}${document.getElementById('itEquipmentCost').value})</td>
                        <td>${currencySymbol}${formatNumber(itEquipmentCost)}</td>
                        ${currency !== 'USD' ? `<td>$${formatNumber(convertToUSD(itEquipmentCost, currency))}</td>` : ''}
                        <td>${((itEquipmentCost / totalCapex) * 100).toFixed(1)}%</td>
                    </tr>
                    <tr>
                        <td>Legal & Broker Fees</td>
                        <td>${currencySymbol}${formatNumber(legalFees)}</td>
                        ${currency !== 'USD' ? `<td>$${formatNumber(convertToUSD(legalFees, currency))}</td>` : ''}
                        <td>${((legalFees / totalCapex) * 100).toFixed(1)}%</td>
                    </tr>
                    <tr>
                        <td>Contingency (${contingency}%)</td>
                        <td>${currencySymbol}${formatNumber(contingencyAmount)}</td>
                        ${currency !== 'USD' ? `<td>$${formatNumber(convertToUSD(contingencyAmount, currency))}</td>` : ''}
                        <td>${contingency}%</td>
                    </tr>
                    <tr style="font-weight: bold; background: #f0f0f0;">
                        <td>TOTAL CAPEX</td>
                        <td>${currencySymbol}${formatNumber(totalCapex)}</td>
                        ${currency !== 'USD' ? `<td>$${formatNumber(convertToUSD(totalCapex, currency))}</td>` : ''}
                        <td>100%</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2 class="section-title">Key Performance Indicators</h2>
            <div class="grid">
                <div class="metric">
                    <div class="metric-label">Cost per Employee (Monthly)</div>
                    <div class="metric-value">${currencySymbol}${formatNumber(monthlyOpex / totalHeadcount)}</div>
                    ${currency !== 'USD' ? `<div class="metric-subvalue">$${formatNumber(convertToUSD(monthlyOpex / totalHeadcount, currency))} USD</div>` : ''}
                </div>
                <div class="metric">
                    <div class="metric-label">Cost per Sq M (Monthly)</div>
                    <div class="metric-value">${currencySymbol}${formatNumber(monthlyOpex / totalArea)}</div>
                    ${currency !== 'USD' ? `<div class="metric-subvalue">$${formatNumber(convertToUSD(monthlyOpex / totalArea, currency))} USD</div>` : ''}
                </div>
                <div class="metric">
                    <div class="metric-label">Space per Employee</div>
                    <div class="metric-value">${(totalArea / totalHeadcount).toFixed(1)} sq m</div>
                    <div class="metric-subvalue">${((totalArea * 10.764) / totalHeadcount).toFixed(1)} sq ft</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Workspace Efficiency</div>
                    <div class="metric-value">${document.getElementById('kpiEfficiency').textContent}</div>
                    <div class="metric-subvalue">utilization rate</div>
                </div>
            </div>
        </div>

        <div class="highlight">
            <strong>5-Year Total Cost of Ownership (TCO):</strong><br>
            Assuming 5% annual escalation in operating costs:<br>
            Year 1: ${currencySymbol}${formatNumber(monthlyOpex * 12)}<br>
            5-Year TCO: ${currencySymbol}${formatNumber(monthlyOpex * 12 * 5.53)} (including CAPEX)<br>
            ${currency !== 'USD' ? `5-Year TCO (USD): $${formatNumber(convertToUSD(monthlyOpex * 12 * 5.53, currency))}` : ''}
        </div>

        <div class="footer">
            <p><strong>Report Generated:</strong> ${new Date().toLocaleString()}</p>
            <p>Dyninno Office Space Planner V2 | Professional Edition</p>
            <p>All calculations are estimates and should be verified with local market conditions</p>
        </div>
    </div>
</body>
</html>
            `;
            
            // Open report in new window for printing/saving
            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(reportHTML);
            reportWindow.document.close();
            
            // Add print button functionality
            setTimeout(() => {
                reportWindow.document.title = `Office Report - ${location} - ${new Date().toLocaleDateString()}`;
                reportWindow.focus();
            }, 100);
            
            showNotification('Report generated! Use Ctrl+P (or Cmd+P on Mac) to save as PDF.', 'success');
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            // Initialize space groups
            initializeSpaceGroups();
            // Set India defaults on load
            updateCities(); // This will populate cities for India
            document.getElementById('rentPerSqm').value = '1200'; // Delhi rent rate
            updateLocationBadge();
            calculate();
            buildSpaceMatrix();
        });
    </script>
</body>
</html>
